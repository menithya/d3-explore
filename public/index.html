

<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <style>
        body {
            font-family: Helvetica, Arial, sans-serif
        }

        h1 {
            background-color: #2a5599;
            /* TODO 1
            change the text to white and add a padding of 5px
            2 lines of code
            */
            color: #ffffff;
            padding:5px;
        }

        /* TODO 2
        Add code to show a black border of 1px around all SVGs elements in the page
        1-3 lines of code
        */
         svg{
            border:1px solid black;
        }

        /* TODO 3
         - Use the "display flex" feature from to show the items from class `mainView` side by side 
         1-3 lines of cide
        */
        .mainView{
            display: flex;
        }
    </style>
</head>

<body>
    <h1>Airlines Routes</h1>
    <div class="mainView">
        <div>
            <h2>Airlines</h2>
            <svg id="AirlinesChart"></svg>
        </div>
        <div>
            <h2>Airports</h2>
            <svg id="Map"></svg>
        </div>
    </div>


</body>
 <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
 <script type="text/javascript">
     let store = {};

     function loadData(){
        // let promise = 

       return Promise.all([
            d3.csv('routes.csv'),
            d3.json('countries.geo.json')
        ]).then(function(result){
            // console.log(result)
            store.routes = result[0];
            store.geoJSON = result[1];
            // return store
            // drawAirlineChart(store.routes)

        },function(error){
            console.log(error)

        })

     }

     function getAirlinesChartConfig(){
        let width = 350;
        let height = 400;
        let margin = {
            top:10,
            bottom:50,
            left: 130,
            right: 10
        }

        let bodyHeight = height - margin.top - margin.bottom;
        let bodyWidth = width - margin.left - margin.right;

        let container = d3.select('#AirlinesChart');
        container
            .attr('width',width)
            .attr('height',height)

        return {width, height,margin, bodyHeight, bodyWidth, container};
     }

     function getAirlinesChartScales(airlines,config){
        let {bodyWidth, bodyHeight} = config
        let maximuCount = d3.max(airlines, item => item.count)
        let xScale = d3.scaleLinear()
                        .range([0,bodyWidth])
                        .domain([0,maximuCount])

        let yScale = d3.scaleBand()
                        .range([0,bodyHeight])
                        .domain(airlines.map(a => a.AirlineName))
                        .padding(0.2)

        return {xScale,yScale}

     }

     function drawBarAirlinesChart(airlines,scales,config) {
        let {margin,container} = config;
        let {xScale,yScale} = scales;
        let body = container.append('g')
                    .style("transform",`translate(${margin.let}px,${margin.top})`)

        let bars = body.selectAll('.bar')
                        .data(airlines)

        bars.enter().append("rect")
            .attr('height',yScale.bandwidth())
            .attr("y", (d) => yScale(d.AirlineName))
            .attr("width", (d) => xScale(d.count)) // set the width of the bar to be proportional to the airline count using the xScale
            .attr("fill","#2a5599")
            

     }

     function drawAirlineChart(airlines) {
        let config = getAirlinesChartConfig();
        let scales = getAirlinesChartScales(airlines,config);
        drawBarAirlinesChart(airlines,scales,config)
     }

     function groupByAirLine(data){
        let result = data.reduce((prevObj,currenObj) => {
                let currentData = prevObj[currenObj.AirlineID] || {
                    "AirlineID":currenObj.AirlineID,
                    "AirlineName":currenObj.AirlineName,
                    "count":0                                    
                };
                currentData.count += 1

                prevObj[currenObj.AirlineID] = currentData
                return prevObj
        },{})

        result = Object.keys(result).map(key => result[key])
        result.sort((a,b) => d3.descending(a.count, b.count))

        return result;

     }

     function showData() {
          //Get the routes from our store variable
          let routes = store.routes
          // Compute the number of routes per airline.
          let airlines = groupByAirLine(store.routes);
          // console.log(airlines)
          drawAirlineChart(airlines)
        }

     loadData().then(showData)
 </script>
</html>